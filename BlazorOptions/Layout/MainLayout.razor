@inherits LayoutComponentBase
@implements IDisposable
@inject BlazorOptions.ViewModels.MainLayoutViewModel ViewModel

<MudLayout>
    <MudAppBar>
        <MudText Typo="Typo.h6">Blazor Options</MudText>
        <MudStack Row="true" Spacing="1" Class="appbar-links">
            <MudNavLink Href="/" Match="NavLinkMatch.All" Class="appbar-link">Home</MudNavLink>
            <MudNavLink Href="/positions" Class="appbar-link">Positions</MudNavLink>
            <MudNavLink Href="/trading-history" Class="appbar-link">Trading</MudNavLink>
            <MudNavLink Href="/volume-heatmap" Class="appbar-link">Heatmap</MudNavLink>
            <MudNavLink Href="/bybit-settings" Class="appbar-link">Bybit</MudNavLink>
        </MudStack>
        <MudSpacer />
        @if (ViewModel.IsAuthenticated && !string.IsNullOrWhiteSpace(ViewModel.UserName))
        {
            <MudText Typo="Typo.subtitle2">@ViewModel.UserName</MudText>
        }
        <MudIconButton Icon="@Icons.Material.Filled.AccountCircle"
                       Color="Color.Inherit"
                       Href="account-settings"
                       aria-label="Account settings" />
    </MudAppBar>
    <MudMainContent>
        @Body
    </MudMainContent>
</MudLayout>

@code {
    protected override void OnInitialized()
    {
        ViewModel.OnChange += HandleViewModelChanged;
    }

    protected override async Task OnInitializedAsync()
    {
        await ViewModel.InitializeAsync();
    }

    public void Dispose()
    {
        ViewModel.OnChange -= HandleViewModelChanged;
        ViewModel.Dispose();
    }

    private void HandleViewModelChanged()
    {
        _ = InvokeAsync(StateHasChanged);
    }
}

<style>
    .appbar-links {
        margin-left: 16px;
        align-items: center;
    }

    .appbar-link {
        color: inherit;
        text-decoration: none;
        font-weight: 500;
    }

    .appbar-link.active {
        text-decoration: underline;
    }
</style>
