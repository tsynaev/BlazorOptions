@using BlazorOptions.ViewModels
@using Microsoft.AspNetCore.Components.Web

@if (ViewModel is not null)
{
    <MudCard>
        <MudCardHeader>
            <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2" Class="flex-grow-1">
                <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="1">
                    <MudCheckBox T="bool"
                                 Value="@ViewModel.IsVisible"
                                 ValueChanged="async visible => await ViewModel.SetVisibilityAsync(visible)"/>
                    <MudPaper Class="portfolio-color-swatch" Style="@($"background-color:{ViewModel.Color};")" Elevation="0"/>
                    <MudText Typo="Typo.h6">@ViewModel.Name</MudText>
                </MudStack>
                <MudSpacer/>
                <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="1">
                    <MudTooltip Text="Duplicate portfolio">
                        <MudIconButton Icon="@Icons.Material.Filled.FileCopy"
                                       Color="Color.Default"
                                       OnClick="async () => await ViewModel.DuplicateCollectionAsync()"/>
                    </MudTooltip>
                    <MudButton Variant="Variant.Outlined"
                               Color="Color.Default"
                               StartIcon="@Icons.Material.Filled.CloudDownload"
                               OnClick="async () => await ViewModel.LoadBybitPositionsAsync()">
                    </MudButton>
                    <MudTooltip Text="Add leg">
                        <MudIconButton Icon="@Icons.Material.Filled.AddCircle"
                                       Color="Color.Primary"
                                       OnClick="async () => await ViewModel.AddLegAsync()"/>
                    </MudTooltip>
                    <MudTooltip Text="Portfolio settings">
                        <MudIconButton Icon="@Icons.Material.Filled.MoreVert"
                                       Color="Color.Default"
                                       OnClick="async () => await ViewModel.OpenSettingsAsync()"/>
                    </MudTooltip>
                </MudStack>
            </MudStack>

        </MudCardHeader>
        <MudCardContent>
            <MudTable Items="@ViewModel.Legs" Dense="true" Hover="true" Class="leg-table">
                <HeaderContent>
                    <MudTh>Include</MudTh>
                    <MudTh>Type</MudTh>
                    <MudTh>Strike</MudTh>
                    <MudTh>Expiration</MudTh>
                    <MudTh>Size</MudTh>
                    <MudTh>Price</MudTh>
                    <MudTh>Temp P/L</MudTh>
                    <MudTh Class="iv-column">IV</MudTh>
                    <MudTh></MudTh>
                </HeaderContent>
                <RowTemplate>
                    <LegRow ViewModel="context" />
                </RowTemplate>
            </MudTable>
            <MudCardActions>
                <QuickAddPanel ViewModel="ViewModel.QuickAdd"/>
            </MudCardActions>
        </MudCardContent>
    </MudCard>
}

@code {
    [Parameter, EditorRequired] public LegsCollectionViewModel ViewModel { get; set; }
}

<style>
    .portfolio-color-swatch {
        width: 24px;
        height: 24px;
        border-radius: 4px;
        border: 1px solid rgba(255, 255, 255, 0.12);
    }

    .portfolio-color-picker input {
        padding: 0;
        width: 28px;
        height: 28px;
    }

    .portfolio-color-picker .mud-input-root {
        padding: 0;
    }

    .portfolio-color-picker .mud-input-underline,
    .portfolio-color-picker .mud-input-outlined-border {
        border: 0;
    }

    .iv-column {
        width: 110px;
        min-width: 110px;
    }

    .iv-input .mud-input-root {
        max-width: 90px;
    }

    .iv-chain {
        display: block;
        margin-top: 2px;
        line-height: 1.1;
    }

    .price-input .mud-input-root {
        max-width: 120px;
    }

    .price-chain {
        display: block;
        margin-top: 2px;
        line-height: 1.1;
    }
</style>
